<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css">
    <title>【ケーバイエヌ】</title>
	<style>
		/* Loading Block */
		#loading {
		  width: 100vw;
		  height: 100vh;
		  transition: all 1s;
		  background-color: #fff;
		  position: fixed;
		  top: 0;
		  left: 0;
		  z-index: 9999;
		}
		.spinner {
		  width: 100px;
		  height: 100px;
		  margin: 200px auto;
		  background-color: #7BCAC6;
		  border-radius: 100%;
		  animation: sk-scaleout 1.0s infinite ease-in-out;
		}
		/* Loading Animation */
		@keyframes sk-scaleout {
		  0% {
			transform: scale(0);
		  } 100% {
			transform: scale(1.0);
			opacity: 0;
		  }
		}

		/* Hide Loading Block */
		.loaded {
		  opacity: 0;
		  visibility: hidden;
		}
		.inputArrartShow {
			opacity: 1;
			visibility: visible;
		}
		.inputArrart {
		  opacity: 0;
		  visibility: hidden;
		}
	</style>
</head>

<body>
	<div id="loading">
	  <div class="spinner"></div>
	</div>
	
	<form class="w-75 mx-auto"  name="form1">
		<p class="mt-3">■ ご予約内容 ■■■■■■</p>
		<p class="mt-3">シッティングタイプ</p>
		<div>
			<p class="mt-3"><input  type="radio" name="type" placeholder=""  value="単発保育" checked required>単発保育</p>
			<p class="mt-3"><input  type="radio" name="type" placeholder=""  value="定期保育" >定期保育</p>
			<p class="mt-3"><input  type="radio" name="type" placeholder=""  value="送迎保育">送迎保育</p>
		</div>
		<p class="mt-3">希望日時<small>※ 定期保育をご希望の方は開始希望日時を入力してください</small></p>
		<div class="perDateCon">
		<input type="date" class="form-control w-100 mt-1" id="preDate" name="preDate" />
		</div>
		<br>
		<div>
			<select name="sTimeH">
				<option value="0">0</option>
				<option value="1">1</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5</option>
				<option value="6">6</option>
				<option value="7">7</option>
				<option value="8">8</option>
				<option value="9">9</option>
				<option value="10">10</option>
				<option value="11">11</option>
				<option value="12">12</option>
				<option value="13">13</option>
				<option value="14">14</option>
				<option value="15">15</option>
				<option value="16">16</option>
				<option value="17">17</option>
				<option value="18">18</option>
				<option value="19">19</option>
				<option value="20">20</option>
				<option value="21">21</option>
				<option value="22">22</option>
				<option value="23">23</option>
			</select>
			:
			<select name="sTimeM">
				<option value="0">0</option>
				<option value="5">5</option>
				<option value="10">10</option>
				<option value="15">15</option>
				<option value="20">20</option>
				<option value="25">25</option>
				<option value="30">30</option>
				<option value="35">35</option>
				<option value="40">40</option>
				<option value="45">45</option>
				<option value="50">50</option>
				<option value="55">55</option>
			</select>
			から
			<select name="eTimeH">
				<option value="0">0</option>
				<option value="1">1</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5</option>
				<option value="6">6</option>
				<option value="7">7</option>
				<option value="8">8</option>
				<option value="9">9</option>
				<option value="10">10</option>
				<option value="11">11</option>
				<option value="12">12</option>
				<option value="13">13</option>
				<option value="14">14</option>
				<option value="15">15</option>
				<option value="16">16</option>
				<option value="17">17</option>
				<option value="18">18</option>
				<option value="19">19</option>
				<option value="20">20</option>
				<option value="21">21</option>
				<option value="22">22</option>
				<option value="23">23</option>
			</select>
			:
			<select name="eTimeM">
				<option value="0">0</option>
				<option value="5">5</option>
				<option value="10">10</option>
				<option value="15">15</option>
				<option value="20">20</option>
				<option value="25">25</option>
				<option value="30">30</option>
				<option value="35">35</option>
				<option value="40">40</option>
				<option value="45">45</option>
				<option value="50">50</option>
				<option value="55">55</option>
			</select>
		</div>

		<p class="mt-3">希望曜日<br><small>※ 定期保育をご希望の方のみ入力してください</small></p>
		<div>
		  <fieldset>
			<input type="checkbox" id="Sun" name="dow" value="日"><label for="check1">日</label>
			<input type="checkbox" id="Mon" name="dow" value="月"><label for="check1">月</label>
			<input type="checkbox" id="Tue" name="dow" value="火"><label for="check1">火</label>
			<input type="checkbox" id="Wed" name="dow" value="水"><label for="check1">水</label>
			<input type="checkbox" id="Thu" name="dow" value="木"><label for="check1">木</label>
			<input type="checkbox" id="Fri" name="dow" value="金"><label for="check1">金</label>
			<input type="checkbox" id="Sat" name="dow" value="土"><label for="check1">土</label>
		  </fieldset>
		</div>

	<p class="mt-3">シッティング希望場所</p>
	<div>
		<input class="form-control w-100 mt-1" id="dePlace" name="dePlace" placeholder="" required>
	</div>

	<p class="mt-3">言語</p>    
	<div>
		<p class="mt-3"><input  type="radio" name="lang" placeholder=""  value="日本語" checked required>日本語</p></p>
		<p class="mt-3"><input  type="radio" name="lang" placeholder=""  value="英語" >英語</p>
		<p class="mt-3"><input  type="radio" name="lang" placeholder=""  value="日本語+英語" >日本語+英語</p>
		<p class="mt-3"><input  type="radio" name="lang" placeholder=""  value="その他" >その他</p>
	</div>

	<p class="mt-3">その他の言語を希望の方</p>
	<div>
			<input class="form-control w-100 mt-1" id="langOther" name="langOther" placeholder="">
		</div>

	<p class="mt-3">ペットの有無</p>    
		<div>
			<p class="mt-3"><input  type="radio" name="pet" placeholder=""  value="いる" checked required>いる</p>
			<p class="mt-3"><input  type="radio" name="pet" placeholder=""  value="いない" >いない</p>
		</div>
	<p class="mt-3">ペットの種類</p>
	<div>
			<input class="form-control w-100 mt-1" id="petKinds" name="petKinds" placeholder="">
		</div>

	<p class="mt-3">備考</p>
		<div>
			<textarea class="form-control" id="exampleFormControlTextarea1"  id="biko" name="biko" rows="3" ></textarea>
		</div>
	<br>
	<p class="mt-3">■ お客様（保護者）の情報 ■■■■■■</p>
	<p class="mt-3">名前</p>
	<div>
		<input class="form-control w-100 mt-1" id="name" name="name" placeholder="" required>
	</div>
	<p class="mt-3">フリガナ</p>
	<div>
		<input class="form-control w-100 mt-1" id="furigana" name="furigana" placeholder="" required>
	</div>
	<p class="mt-3">誕生日</p>
	<div class="birthdayDateCon">
		<input type="date" class="form-control w-100 mt-1" id="birthday" name="birthday" />
	</div>
	<p class="mt-3">電話番号</p>
	<div>
		<input type="tel" class="form-control w-100 mt-1" id="phoneNo" name="phoneNo" placeholder="" required>
	</div>
	<p class="mt-3">メールアドレス</p>
	<div>
		<input type="email" class="form-control w-100 mt-1" id="email" name="email" placeholder="" required>
	</div>
	<p class="mt-3">住所</p>
	<div>
		<input class="form-control w-100 mt-1" id="address" name="address" placeholder="" required>
	</div>
	<p class="mt-3">最寄り駅</p>
	<div>
		<input class="form-control w-100 mt-1" id="station" name="station" required><br>
		から徒歩<input class="form-control w-50 mt-1" id="time" name="time" required>分
	</div>
	<p class="mt-3">■ 1人目のお子様の情報 ■■■■■■</p>
	<p class="mt-3">名前</p>
	<div>
		<input class="form-control w-100 mt-1" id="child1name" name="child1name" placeholder="">
	</div>
	<p class="mt-3">フリガナ</p>
	<div>
		<input class="form-control w-100 mt-1" id="child1furigana" name="child1furigana" placeholder="">
	</div>
	<p class="mt-3">ご家庭での呼び方 (カタカナ入力)</p>
	<div>
		<input class="form-control w-100 mt-1" id="child1nickname" name="child1nickname" placeholder="">
	</div>
	<p class="mt-3">お誕生日</p>
		<div>
			<input type="date" class="form-control w-100 mt-1" id="child1birthday" name="child1birthday">
		</div>
	<p class="mt-3">性別</p>    
		<div>
			<p class="mt-3"><input  type="radio" name="child1sex" placeholder=""  value="男の子" required>男の子</p>
			<p class="mt-3"><input  type="radio" name="child1sex" placeholder=""  value="女の子" >女の子</p>
		</div>

		<p class="mt-3">■ 2人目のお子様の情報 ■■■■■■</p>
		<p class="mt-3">名前</p>
		<div>
			<input class="form-control w-100 mt-1" id="child2name" name="child2name" placeholder="">
		</div>
		<p class="mt-3">フリガナ</p>
		<div>
			<input class="form-control w-100 mt-1" id="child2furigana" name="child2furigana" placeholder="">
		</div>
		<p class="mt-3">ご家庭での呼び方 (カタカナ入力)</p>
		<div>
			<input class="form-control w-100 mt-1" id="child2nickname" name="child2nickname" placeholder="">
		</div>
	<p class="mt-3">お誕生日</p>
		<div>
			<input type="date" class="form-control w-100 mt-1" id="child2birthday" name="child2birthday">
		</div>
	<p class="mt-3">性別</p>    
		<div>
			<p class="mt-3"><input  type="radio" name="child2sex" placeholder=""  value="男の子" required>男の子</p>
			<p class="mt-3"><input  type="radio" name="child2sex" placeholder=""  value="女の子" >女の子</p>
		</div>	    

		<p class="mt-3">■ 3人目のお子様の情報 ■■■■■■</p>
		<p class="mt-3">名前</p>
		<div>
			<input class="form-control w-100 mt-1" id="child3name" name="child3name" placeholder="">
		</div>
		<p class="mt-3">フリガナ</p>
		<div>
			<input class="form-control w-100 mt-1" id="child3furigana" name="child3furigana" placeholder="">
		</div>
		<p class="mt-3">ご家庭での呼び方 (カタカナ入力)</p>
		<div>
			<input class="form-control w-100 mt-1" id="child3nickname" name="child3nickname" placeholder="">
		</div>
	<p class="mt-3">お誕生日</p>
		<div>
			<input type="date" class="form-control w-100 mt-1" id="child3birthday" name="child3birthday">
		</div>
	<p class="mt-3">性別</p>    
		<div>
			<p class="mt-3"><input  type="radio" name="child3sex" placeholder=""  value="男の子" required>男の子</p>
			<p class="mt-3"><input  type="radio" name="child3sex" placeholder=""  value="女の子" >女の子</p>
	</div>
	
	<div class="alert alert-danger" id="inputArrart" role="alert">
	  <p  id="arartText" ></p>
	</div>
	
	<input  type="submit" class="mt-4 btn btn-primary" value="送信">
	</form>
    <br>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>

    <script>
        $(document).ready(function () {
            const liffId = "1661328491-NK747zok";
            initializeLiff(liffId);
        })
        
        liff.ready.then(() => {
          if (!liff.isLoggedIn()) {
            liff.login();
          }
			const idToken = liff.getDecodedIDToken();
			const userId = idToken.sub;
			getData(userId);
        })        
        
        function initializeLiff(liffId) {
            liff.init({
                liffId: liffId
            }).then(() => {
                initializeApp();
            }).catch((err) => {
                console.log('LIFF Initialization failed ', err);
            });
        }

        function sendText(text) {
            liff.sendMessages([{
                'type': 'text',
                'text': text
            }]).then(function () {
                liff.closeWindow();
            }).catch(function (error) {
                window.alert('Failed to send message ' + error);
            });
        }

        const params = (new URL(document.location)).searchParams;
        const key = params.get('key');

        $(function () {
            $('form').submit(function () {
				// 曜日取得
				let yobivalue= "";
				$('input[name=dow]:checked').each(function() {
					if(yobivalue!=""){
						yobivalue = yobivalue + ",";
					}
					yobivalue = yobivalue + $(this).val();
				});
				
				// チェックしてアラートを出す
				let arartText = "";
				let perDateArart = "";
				let birthdayArart = "";
				
				// 希望日のチェック
				if($('input[name="preDate"]').val()==""){
					perDateArart = "希望日を入力してください"
				}				
				// 誕生日のチェック
				if($('input[name="birthday"]').val()==""){
					if(perDateArart!=""){
						birthdayArart = "\n";
					}
					birthdayArart = birthdayArart+"保護者の誕生日を入力してください"
				}
				arartText = perDateArart + birthdayArart;
				
				if(arartText!=""){
					$("#inputArrart").text(arartText);
					document.getElementById('inputArrart').classList.add('inputArrartShow');
					return false;
				}

				const name    = $('input[name="name"]').val();
				const furigana = $('input[name="furigana"]').val();
				const type    = $('input:radio[name="type"]:checked').val();
				const preDate = $('input[name="preDate"]').val();
				const sTime = $('[name=sTimeH]').val() + ":" + $('[name=sTimeM]').val();
				const eTime = $('[name=eTimeH]').val() + ":" + $('[name=eTimeM]').val();
				const yobi = yobivalue;
				const lang = $('input:radio[name="lang"]:checked').val();
				const langOther = $('input[name="langOther"]').val();
				const pet = $('input:radio[name="pet"]:checked').val();
				const petKinds = $('input[name="petKinds"]').val();
				const biko = $('textarea[name="biko"]').val();
				const birthday = $('input[name="birthday"]').val();
				const phoneNo  = $('input[name="phoneNo"]').val();
				const email  = $('input[name="email"]').val();
				const address = $('input[name="address"]').val();
				const station = $('input[name="station"]').val();
				const time = $('input[name="time"]').val();
				const child1name = $('input[name="child1name"]').val();
				const child1furigana = $('input[name="child1furigana"]').val();
				const child1nickname = $('input[name="child1nickname"]').val();
				const child1birthday = $('input[name="child1birthday"]').val();
				const child1sex = $('input:radio[name="child1sex"]:checked').val();
				const child2name = $('input[name="child2name"]').val();
				const child2furigana = $('input[name="child2furigana"]').val();
				const child2nickname = $('input[name="child2nickname"]').val();
				const child2birthday = $('input[name="child2birthday"]').val();
				const child2sex = $('input:radio[name="child2sex"]:checked').val();
				const child3name = $('input[name="child3name"]').val();
				const child3furigana = $('input[name="child3furigana"]').val();
				const child3nickname = $('input[name="child3nickname"]').val();
				const child3birthday = $('input[name="child3birthday"]').val();
				const child3sex = $('input:radio[name="child3sex"]:checked').val();

				const msg = `【区分】ご予約\n【氏名】${name}\n【フリガナ】${furigana}\n【タイプ】${type}\n【希望日時】${preDate}\n【開始】${sTime}\n【終了】${eTime}\n【曜日】${yobi}\n【言語】${lang}\n【その他言語】${langOther}\n【ペット】${pet}\n【ペットの種類】${petKinds}\n【備考】${biko}\n【生年月日】${birthday}\n【電話番号】${phoneNo}\n【メールアドレス】${email}\n【住所】${address}\n【最寄り駅】${station}\n【徒歩】${time}\n【1人目のお名前】${child1name}\n【フリガナ】${child1furigana}\n【呼び方】${child1nickname}\n【誕生日】${child1birthday}\n【性別】${child1sex}\n【2人目のお名前】${child2name}\n【フリガナ】${child2furigana}\n【呼び方】${child2nickname}\n【誕生日】${child2birthday}\n【性別】${child2sex}\n【3人目のお名前】${child3name}\n【フリガナ】${child3furigana}\n【呼び方】${child3nickname}\n【誕生日】${child3birthday}\n【性別】${child3sex}`;

				alert(msg);
				sendText(msg);
				return false;
            });
        });

    </script>
    
	<script>
		window.onload = function() {
			const spinner = document.getElementById('loading');
			
			setTimeout(function() {
				// Add .loaded to .loading
				spinner.classList.add('loaded');
			}, 3000);

		}
	</script>
	
    <script>
        function getData(userID) {
            const endpoint = "https://script.google.com/macros/s/AKfycbwsQYEEajE-pXvm_FVPR6Y9sCNAljuXQNEd3IUMDDfZz_0HSXJWlbQy5UHn7rMktyg/exec";
              
            //APIを使って非同期データを取得する
            fetch((urlOf(endpoint, { userID: userID })))
            .then(response => response.json())
            /*成功した処理*/
            .then(data => {
                //JSONから配列に変換
                const object = data;
                //inputタグそれぞれに取得したデータを設定
                $('input').each(function (index, element) {
                    if (object[0][$(element).attr('name')]) {
                        $(element).val([object[0][$(element).attr('name')]]);
                    }
                });
            });
         }
        
        function urlOf(url, params) {
            return `${url}?${Object.entries(params).map(([key, value]) => `${encodeURIComponent(key)}=${encodeURIComponent(value)}`).join('&')}`;
        }
    </script>
	
</body>
</html>
